$(document).ready(function(){function e(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function t(e){$.ajax({type:"GET",url:e,dataType:"xml",success:function(e){$(e).find("ip").each(function(){var e=$(this).find("city").text(),t=$(this).find("region").text();if(e!=t)i=e+", "+t;else var i=e;$('<input type="hidden" />').attr({name:"location",class:"location",value:i}).appendTo("form")})}})}!function(e,t,i){for(var n,a,r,s=[],o=e.scripts[0],p="onreadystatechange",u="readyState";n=i.shift();)a=e.createElement(t),"async"in o?(a.async=!1,e.head.appendChild(a)):o[u]?(s.push(a),a[p]=function(){for(;s[0]&&"loaded"==s[0][u];)r=s.shift(),r[p]=!o.parentNode.insertBefore(r,o)}):e.write("<"+t+' src="'+n+'" defer></'+t+">"),a.src=n}(document,"script",["https://maps.googleapis.com/maps/api/js?key=AIzaSyAdzwz73OHrdVGjKVKow8ID8T31yNxiBSI","js/map.js"]),$(".res_block .item").click(function(){$(this).closest(".res_block").find(".item").hide();var e=$(this).closest(".res_block").find(".view_block"),t=$(this).attr("data-src");e.find(".view_img").find("img").length>0?e.find(".view_img").find("img").attr("src",t):e.find(".view_img").append('<img src="'+t+'">'),e.show()}),$(".res_block .view_block .close_view").click(function(){$(this).closest(".res_block").find(".item").show(),$(this).closest(".res_block").find(".view_block").hide()}),$('input[name="name"]').blur(function(){$(this).val().length<2&&$(this).addClass("error-input")}),$('input[name="name"]').focus(function(){$(this).removeClass("error-input")}),$('input[name="phone"]').mask("+7 (999) 999-99-99"),$('input[name="phone"]').blur(function(){18!=$(this).val().length&&$(this).addClass("error-input")}),$('input[name="phone"]').focus(function(){$(this).removeClass("error-input")}),$.get("http://ipinfo.io",function(e){geo_url="http://ipgeobase.ru:7020/geo?ip="+e.ip,t(geo_url)},"jsonp"),utm=[],$.each(["utm_source","utm_medium","utm_campaign","utm_term","source_type","source","position_type","position","added","creative","matchtype"],function(t,i){$('<input type="hidden" />').attr({name:i,class:i,value:function(){return void 0==e(i)?"-":e(i)}}).appendTo("form")}),$('<input type="hidden" />').attr({name:"url",value:document.location.href}).appendTo("form"),$('<input type="hidden" />').attr({name:"title",value:document.title}).appendTo("form"),$("form").submit(function(e){if(e.preventDefault(),$(this).find('input[type="text"]').trigger("blur"),$(this).find('input[type="text"]').hasClass("error-input")){var t="";$(this).find('input[name="name"]').hasClass("error-input")&&!$(this).find('input[name="phone"]').hasClass("error-input")?t="Пожалуйста введите имя":$(this).find('input[name="phone"]').hasClass("error-input")&&!$(this).find('input[name="name"]').hasClass("error-input")?t="Пожалуйста введите телефон":$(this).find('input[name="phone"]').hasClass("error-input")&&$(this).find('input[name="name"]').hasClass("error-input")&&(t="Пожалуйста введите имя и телефон"),$("#form-error-text").html(t),$("#form-error-pop").arcticmodal()}else{var i=$(this).attr("method"),n=$(this).attr("action"),a=$(this).serialize();$(this).find('input[name="event"]').val();$.ajax({type:i,url:n,data:a,success:function(){$.arcticmodal("close"),$("#okgo").arcticmodal(),$('input[name="name"]').val(""),$('input[name="phone"]').val(""),"undefined"!=typeof yaCounter46130496&&yaCounter46130496.reachGoal("zayavka_sitewriters.ru"),"undefined"!=typeof ga&&ga("send","event","zayavka_sitewriters.ru","zayavka_sitewriters.ru"),"undefined"!=typeof _gaq&&_gaq.push("_trackEvent","zayavka_sitewriters.ru","zayavka_sitewriters.ru")}})}}),$(".pop .close").click(function(){$(this).closest(".pop").arcticmodal("close")})});